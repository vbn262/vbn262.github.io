<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>冖井的壁纸</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">
    <style>
        /* 全局基础样式 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        ::-webkit-scrollbar {
            display: none;
        }

        /* 筛选按钮核心样式（整合并优化） */
        .filter-btn.active {
            background: linear-gradient(135deg, #FF4D8D, #ff6a9e) !important;
            color: white !important;
            border-color: #ff8fb2 !important;
            box-shadow: 0 0 12px rgba(255, 77, 141, 0.3), 0 2px 8px rgba(255, 77, 141, 0.2);
            position: relative;
        }

            .filter-btn.active::after {
                content: '';
                position: absolute;
                bottom: -6px;
                left: 50%;
                transform: translateX(-50%);
                width: 0;
                height: 0;
                border-left: 6px solid transparent;
                border-right: 6px solid transparent;
                border-top: 6px solid #FF4D8D;
            }

        .filter-btn:not(.active):hover {
            background: linear-gradient(120deg, #fff5f8, #fff0f5);
            border-color: #ff8fb2;
            transform: translateY(-1px);
        }

        .filter-btn:active {
            transform: translateY(0) scale(0.97);
        }

        .filter-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
            background: #f9f9f9 !important;
            border-color: #e0e0e0 !important;
            color: #999 !important;
            box-shadow: none !important;
        }

        /* 图片悬停效果 */
        .wallpaper-img {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
            object-fit: cover;
        }

        .close-btn {
            position: absolute;
            top: 20px;
            right: 30px;
            color: white;
            font-size: 2rem;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

            .close-btn:hover {
                transform: scale(1.1);
                color: #ff8fb2;
            }

        /* 返回顶部按钮优化 */
        #back-to-top {
            background: white;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 10px rgba(255, 77, 141, 0.3);
            transition: all 0.3s ease;
            border: 1px solid #ff8fb2;
        }

            #back-to-top:hover {
                background: #fff0f5;
                transform: translateY(-2px);
            }

        /* 筛选加载提示 */
        #filterLoading {
            z-index: 99;
        }
    </style>
</head>
<body class="max-w-[999px] mx-auto bg-cover bg-center bg-fixed bg-no-repeat" id="page-top">
    <header class="fixed top-0 left-0 right-0 px-4 backdrop-blur-sm bg-gradient-to-br from-pink-100/10 to-transparent shadow-md z-50">
        <div class="max-w-[999px] mx-auto" style="font-size: 27px;">
            <div class="flex justify-between items-center" style="border-bottom: 2px solid #FF4D8D;">
                <div class="bg-white flex items-center"><img src="https://www.vbn262.com/00.jpg" class="w-9 h-9 object-contain" alt="冖井的壁纸 Logo">冖井的壁纸</div>
                <a href="https://www.vbn262.com" class="text-pink-600 hover:text-pink-800 transition-colors"><i class="fas fa-chevron-left"></i></a>
            </div>
            <!-- 替换原来的分类筛选按钮部分 -->
            <div class="relative mt-2 mb-3">
                <div class="filter-scroll-container flex gap-2 overflow-x-auto pb-3" id="filterContainer">
                    <button class="filter-btn active shrink-0 px-4 py-2 rounded-full border-2 border-pink-300 bg-gradient-to-r from-pink-100 to-pink-50 text-pink-700 hover:from-pink-200 hover:to-pink-100 text-sm font-medium flex items-center gap-2 min-w-[80px] justify-center transition-all duration-200 shadow-sm hover:shadow" data-filter="all">
                        <i class="fas fa-th-large text-xs"></i> 全部
                    </button>
                    <button class="filter-btn shrink-0 px-4 py-2 rounded-full border-2 border-pink-300 bg-white text-pink-600 hover:bg-pink-50 text-sm font-medium flex items-center gap-2 min-w-[80px] justify-center transition-all duration-200 shadow-sm hover:shadow" data-filter="我的世界">
                        <i class="fas fa-gamepad text-xs"></i> 我的世界
                    </button>
                    <button class="filter-btn shrink-0 px-4 py-2 rounded-full border-2 border-pink-300 bg-white text-pink-600 hover:bg-pink-50 text-sm font-medium flex items-center gap-2 min-w-[80px] justify-center transition-all duration-200 shadow-sm hover:shadow" data-filter="刘亦菲">
                        <i class="fas fa-user text-xs"></i> 刘亦菲
                    </button>
                    <button class="filter-btn shrink-0 px-4 py-2 rounded-full border-2 border-pink-300 bg-white text-pink-600 hover:bg-pink-50 text-sm font-medium flex items-center gap-2 min-w-[80px] justify-center transition-all duration-200 shadow-sm hover:shadow" data-filter="杨幂">
                        <i class="fas fa-user text-xs"></i> 杨幂
                    </button>
                    <button class="filter-btn shrink-0 px-4 py-2 rounded-full border-2 border-pink-300 bg-white text-pink-600 hover:bg-pink-50 text-sm font-medium flex items-center gap-2 min-w-[80px] justify-center transition-all duration-200 shadow-sm hover:shadow" data-filter="赵今麦">
                        <i class="fas fa-user text-xs"></i> 赵今麦
                    </button>
                </div>
                <!-- 简化的加载提示 -->
                <div id="filterLoading" class="hidden absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-pink-600 text-white px-3 py-2 rounded-lg text-sm shadow-lg z-10">
                    <i class="fas fa-spinner fa-spin mr-2"></i> 加载中...
                </div>
            </div>

            <style>
                /* 核心样式 - 保持原有风格 */
                .filter-btn.active {
                    background: linear-gradient(135deg, #FF4D8D, #ff6a9e) !important;
                    color: white !important;
                    border-color: #ff8fb2 !important;
                    box-shadow: 0 0 12px rgba(255, 77, 141, 0.3), 0 2px 8px rgba(255, 77, 141, 0.2);
                    position: relative;
                }

                    .filter-btn.active::after {
                        content: '';
                        position: absolute;
                        bottom: -6px;
                        left: 50%;
                        transform: translateX(-50%);
                        width: 20px;
                        height: 3px;
                        background: #FF4D8D;
                        border-radius: 2px;
                    }

                /* 添加平滑滚动 */
                .filter-scroll-container {
                    scroll-behavior: smooth;
                    scrollbar-width: none; /* Firefox */
                    -ms-overflow-style: none; /* IE and Edge */
                }

                    .filter-scroll-container::-webkit-scrollbar {
                        display: none; /* Chrome, Safari, Opera */
                    }
            </style>

            <script>
                // 简化的自动居中逻辑
                document.addEventListener('DOMContentLoaded', function () {
                    const filterContainer = document.getElementById('filterContainer');
                    const filterBtns = document.querySelectorAll('.filter-btn');
                    const filterLoading = document.getElementById('filterLoading');

                    filterBtns.forEach(btn => {
                        btn.addEventListener('click', function () {
                            // 显示加载状态
                            filterLoading.classList.remove('hidden');

                            // 更新按钮状态
                            filterBtns.forEach(b => b.classList.remove('active'));
                            this.classList.add('active');

                            // 简单的自动居中计算
                            const containerWidth = filterContainer.clientWidth;
                            const btnLeft = this.offsetLeft;
                            const btnWidth = this.offsetWidth;

                            // 计算滚动位置，使按钮居中
                            const scrollTo = btnLeft - (containerWidth / 2) + (btnWidth / 2);

                            // 平滑滚动
                            filterContainer.scrollTo({
                                left: scrollTo,
                                behavior: 'smooth'
                            });

                            // 模拟筛选加载
                            setTimeout(() => {
                                filterLoading.classList.add('hidden');
                                // 这里可以触发实际的筛选逻辑
                            }, 300);
                        });
                    });

                    // 初始状态：确保第一个按钮可见
                    setTimeout(() => {
                        filterContainer.scrollLeft = 0;
                    }, 100);
                });
            </script>
        </div>
    </header>
    <!-- 顶部间距（适配header高度） -->
    <div class="pt-[99px]"></div>

    <!-- 壁纸网格 -->
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 my-4 p-4" id="wallpaperGrid">
        <!-- 图片将通过JavaScript动态加载 -->
    </div>

    <!-- 返回顶部按钮 -->
    <a href="#page-top" id="back-to-top" class="scroll-smooth fixed bottom-6 right-4 opacity-0 invisible text-pink-600 transition-all duration-300">
        <i class="fas fa-chevron-up text-xl"></i>
    </a>
    <script>
        // 图片数据
        const wallpapers = [
            { src: "https://www.vbn262.com/01.jpg", tags: "我的世界", alt: "我的世界壁纸" },
            { src: "https://www.vbn262.com/02.jpg", tags: "我的世界", alt: "我的世界壁纸" },
            { src: "https://www.vbn262.com/0.jpeg", tags: "刘亦菲", alt: "刘亦菲壁纸" },
            { src: "https://www.vbn262.com/1.jpg", tags: "刘亦菲", alt: "刘亦菲壁纸" },
            { src: "https://www.vbn262.com/2.jpg", tags: "刘亦菲", alt: "刘亦菲壁纸" },
            { src: "https://www.vbn262.com/3.jpg", tags: "杨幂", alt: "杨幂壁纸" },
            { src: "https://www.vbn262.com/4.jpg", tags: "杨幂", alt: "杨幂壁纸" },
            { src: "https://www.vbn262.com/5.jpg", tags: "刘亦菲", alt: "刘亦菲壁纸" },
            { src: "https://n.sinaimg.cn/sinakd20114/160/w1024h1536/20230507/ac0c-ece250a92cf2dbccad67e30df0467e24.jpg", tags: "赵今麦", alt: "赵今麦壁纸" },
            { src: "https://k.sinaimg.cn/n/sinakd20231004ac/96/w1024h1472/20231004/031d-362de2fda947d1b8720ab513d4b4921f.jpg/w700d1q75cms.jpg", tags: "赵今麦", alt: "赵今麦壁纸" },
            { src: "https://n.sinaimg.cn/sinakd20114/160/w1024h1536/20230507/1664-96734d76911326c6de0d6bb0596d60e5.jpg", tags: "赵今麦", alt: "赵今麦壁纸" },
            { src: "https://n.sinaimg.cn/sinakd10009/50/w1080h1370/20221231/7cac-f9f549c770830aedad3604ec97411c64.jpg", tags: "赵今麦", alt: "赵今麦壁纸" },
            { src: "https://n.sinaimg.cn/sinakd20117/640/w1920h1920/20230408/1246-16ff2c84702627744406ca971111a3cb.jpg", tags: "赵今麦", alt: "赵今麦壁纸" },
            { src: "https://joy.online.sh.cn/images_quote/attachement/jpg/site1/20230301/IMG0025116ac6e762764760083.jpg", tags: "赵今麦", alt: "赵今麦壁纸" },
            { src: "https://n.sinaimg.cn/sinakd10113/600/w1080h1920/20221121/9bd9-3603277dbd60947110534a499cab9b90.jpg", tags: "赵今麦", alt: "赵今麦壁纸" },
            { src: "https://k.sinaimg.cn/n/sinakd20230223ac/2/w2000h2802/20230223/0fa9-ba90a7369c235f44b14ced6fc00cb3df.jpg/w700d1q75cms.jpg", tags: "赵今麦", alt: "赵今麦壁纸" },
            { src: "https://k.sinaimg.cn/n/ent/4_img/upload/3c638c8b/320/w2048h3072/20230209/e5cb-79d29d3804e7b587cc89f9ab1ef16560.jpg/w640slw.jpg", tags: "赵今麦", alt: "赵今麦壁纸" },
            { src: "https://img-s.msn.cn/tenant/amp/entityid/AA1UuwIx.img", tags: "刘亦菲", alt: "刘亦菲壁纸" },
            { src: "https://n.sinaimg.cn/sinakd20113/351/w1080h1671/20220918/3fd6-f81d66d30c6622a33fe297d375ca2b58.jpg", tags: "刘亦菲", alt: "刘亦菲壁纸" },
            { src: "https://static.xsite.com.cn/renwuji.com/wp-content/uploads/images/2023/03/04/568d254fcfba4c9e8e4d3ef26f4665f6~noop_tttp151gagn.jpg", tags: "刘亦菲", alt: "刘亦菲壁纸" },
            { src: "https://n.sinaimg.cn/sinacn03/46/w690h956/20180807/83e2-hhkusks7404503.png", tags: "刘亦菲", alt: "刘亦菲壁纸" },
            { src: "https://static.xsite.com.cn/renwuji.com/wp-content/uploads/images/2022/10/19/ace84e9209cb4039b89d58d8eced22be_ivgozhkvj1t.jpg", tags: "刘亦菲", alt: "刘亦菲壁纸" },
            { src: "https://n.sinaimg.cn/sinakd10009/530/w1398h2332/20230408/53eb-93bc0d566941bbbee8726a6bc33d6a5e.jpg", tags: "刘亦菲", alt: "刘亦菲壁纸" },
            { src: "https://p0.ssl.img.360kuai.com/t110df81bbce1e02710ee256fb3.jpg", tags: "刘亦菲", alt: "刘亦菲壁纸" },
            { src: "https://p0.ifengimg.com/2019_25/FED626DA0ADE276F73C2AFBB0F6649FC5874FFF1_w1080_h1620.jpg", tags: "刘亦菲", alt: "刘亦菲壁纸" },
            { src: "https://www.baike.com.cn/uploads/202305/1683427173sPnE3CfE.jpeg", tags: "刘亦菲", alt: "刘亦菲壁纸" },
            { src: "https://n.sinaimg.cn/sinakd20118/30/w1080h1350/20230323/5232-23cbd0ddd7a8e38cb1f7255f2a23e1cd.jpg", tags: "刘亦菲", alt: "刘亦菲壁纸" },
            { src: "https://k.sinaimg.cn/n/sinakd20231116ac/300/w1080h1620/20231116/9f23-abcb93b14380023cd5b5f0bc2aed32d1.jpg/w700d1q75cms.jpg", tags: "刘亦菲", alt: "刘亦菲壁纸" },
            { src: "https://static.xsite.com.cn/renwuji.com/wp-content/uploads/images/2023/05/22/4bdcb105d4ba449990177f88daef2b51~noop_2ufzspdeema.jpg", tags: "刘亦菲", alt: "刘亦菲壁纸" },
            { src: "https://n.sinaimg.cn/sinakd10109/318/w892h1026/20200806/90c4-ixkvvuc4288719.jpg", tags: "刘亦菲", alt: "刘亦菲壁纸" },
            { src: "https://d.ifengimg.com/w1080_h1620_ablur_q90_webp/p3.ifengimg.com/2019_25/3C9FAE601387E061D520F04262B113F4DBCF5342_w1080_h1620.jpg", tags: "刘亦菲", alt: "刘亦菲壁纸" },
            { src: "https://hao5.qhimg.com/t01c69a40274a6cbdff.jpg?1265*1811", tags: "刘亦菲", alt: "刘亦菲壁纸" },
            { src: "https://n.sinaimg.cn/sinakd20111/138/w2000h2938/20200313/033b-iquxruh6961738.jpg", tags: "刘亦菲", alt: "刘亦菲壁纸" },
            { src: "https://www.bizhigq.com/sj-img/2023-04/1733.jpg", tags: "刘亦菲", alt: "刘亦菲壁纸" },
            { src: "https://n.sinaimg.cn/sinakd20111/730/w1242h2688/20230124/125a-42881484160323a5e56f5631d729b4c4.jpg", tags: "刘亦菲", alt: "刘亦菲壁纸" },
            { src: "https://n.sinaimg.cn/sinakd20122/776/w1432h2544/20230119/3ca0-415f504136dc92e7995af8bcda0beaa5.jpg", tags: "刘亦菲", alt: "刘亦菲壁纸" },
            { src: "https://cdn.svipaigc.com/bizi/2025/03/%E5%88%98%E4%BA%A6%E8%8F%B2%E6%A2%A6%E5%B9%BB%E7%B2%89%E7%BE%BD%E7%A4%BC%E6%9C%8D%E8%A3%99%E5%AD%904k%E6%89%8B%E6%9C%BA%E5%A3%81%E7%BA%B8.jpg", tags: "刘亦菲", alt: "刘亦菲壁纸" },
            { src: "https://n.sinaimg.cn/sinakd20114/446/w1023h1023/20230217/20be-a7d078d67d945d7bd3ff82155136edbe.jpg", tags: "刘亦菲", alt: "刘亦菲壁纸" },
            { src: "https://p4.itc.cn/images01/20220825/f504a330ea9a4409ba3dc734ea9323fe.jpeg", tags: "刘亦菲", alt: "刘亦菲壁纸" },
            { src: "https://n.sinaimg.cn/sinakd20117/204/w2048h2956/20200725/179b-iwtqvym3070411.jpg", tags: "刘亦菲", alt: "刘亦菲壁纸" },
            { src: "https://ts3.tc.mm.bing.net/th/id/OIP-C.3JgLxw_OehlBqa9htrL9yAHaNK", tags: "刘亦菲", alt: "刘亦菲壁纸" },
            { src: "https://p6.itc.cn/q_70/images01/20220814/3fab785188d849228b9f2a5161f9a955.jpeg", tags: "刘亦菲", alt: "刘亦菲壁纸" },
            { src: "https://n.sinaimg.cn/fashion/transform/20160513/11_x-fxsenvm0372657.jpg", tags: "刘亦菲", alt: "刘亦菲壁纸" },
            { src: "https://k.sinaimg.cn/n/sinakd20230117ac/214/w1080h2334/20230117/7f2f-3c3695a782c75646d1fafca297ab9650.jpg/w700d1q75cms.jpg", tags: "刘亦菲", alt: "刘亦菲壁纸" },
            { src: "https://static.xsite.com.cn/renwuji.com/wp-content/uploads/images/2023/01/24/f47a67f3a1e3435ab36e9213e8b739e6~noop_4ew5wmw5qco.jpg", tags: "刘亦菲", alt: "刘亦菲壁纸" },
            { src: "https://n.sinaimg.cn/sinakd10008/456/w2000h2456/20230314/b4fe-c72502b39bc38ce78808c694715affbf.jpg", tags: "杨幂", alt: "杨幂壁纸" },
            { src: "https://n.sinaimg.cn/sinacn10119/521/w2048h2473/20191004/9896-ifmectm2376854.jpg", tags: "杨幂", alt: "杨幂壁纸" },
            { src: "https://p7.qhimg.com/t1169cffb09f87a6198625b14c0.jpg", tags: "杨幂", alt: "杨幂壁纸" },
            { src: "https://p7.qhimg.com/t1169cffb094978c2c7d737412e.jpg", tags: "杨幂", alt: "杨幂壁纸" },
            { src: "https://n.sinaimg.cn/sinakd10009/315/w1080h1635/20221230/220c-270c82c08edcfb627a29662fd0c0b09c.jpg", tags: "杨幂", alt: "杨幂壁纸" },
            { src: "https://www.bizhigq.com/sj-img/2023-03/1536.jpg", tags: "杨幂", alt: "杨幂壁纸" },
            { src: "https://k.sinaimg.cn/n/sinakd10111/300/w1080h1620/20221208/a7c9-e793db5f16a767ee77dbb99ae20a2ac8.jpg/w700d1q75cms.jpg", tags: "杨幂", alt: "杨幂壁纸" },
            { src: "https://k.sinaimg.cn/n/sinakd20100/736/w2048h2688/20211119/cf7a-577cc65a9fac8637020421c7738a74bf.jpg/w700d1q75cms.jpg", tags: "杨幂", alt: "杨幂壁纸" },
            { src: "https://n.sinaimg.cn/sinakd10009/494/w1080h1814/20230108/982c-5bd91c978bbf9b54c4258ae8e6f9ac62.jpg", tags: "杨幂", alt: "杨幂壁纸" },
            { src: "https://p4.itc.cn/q_70/images01/20221102/d95878bb90184c919f96560975872f05.jpeg", tags: "杨幂", alt: "杨幂壁纸" },
            { src: "https://k.sinaimg.cn/n/sinakd20201112ac/227/w1080h1547/20201112/5c55-kcunqze4048991.jpg/w700d1q75cms.jpg", tags: "杨幂", alt: "杨幂壁纸" },
            { src: "https://n.sinaimg.cn/sinakd20118/548/w1500h2248/20230116/8534-143019f7b5fe72884f2d29f2b3e922bd.jpg", tags: "杨幂", alt: "杨幂壁纸" },
            { src: "https://joy.online.sh.cn/images_quote/attachement/jpg/site1/20230828/IMGe0be037d2ca764318914029.jpg", tags: "杨幂", alt: "杨幂壁纸" },
            { src: "https://p4.itc.cn/q_70/images01/20221117/a31e1150f82e42859ce09229041d1f92.jpeg", tags: "杨幂", alt: "杨幂壁纸" },
            { src: "https://p8.itc.cn/q_70/images01/20221209/c05a65fb10b6462695d2ece8ddcefdf9.jpeg", tags: "杨幂", alt: "杨幂壁纸" }
        ];

        // 初始化变量
        let currentFilter = 'all';
        let currentPreviewIndex = 0;
        let filteredWallpapers = [];

        // 1. 返回顶部按钮功能
        window.addEventListener('scroll', () => {
            const backToTopBtn = document.getElementById('back-to-top');
            if (backToTopBtn) {
                const shouldShow = window.scrollY >= 100;
                backToTopBtn.classList.toggle('opacity-0', !shouldShow);
                backToTopBtn.classList.toggle('opacity-100', shouldShow);
                backToTopBtn.classList.toggle('invisible', !shouldShow);
            }
        });

        // 2. 页面加载完成后执行核心逻辑
        document.addEventListener('DOMContentLoaded', function () {
            const filterBtns = document.querySelectorAll('.filter-btn');
            const wallpaperGrid = document.getElementById('wallpaperGrid');
            const previewModal = document.getElementById('previewModal');
            const previewImg = document.getElementById('previewImg');
            const closeBtn = document.getElementById('closeBtn');
            const filterLoading = document.getElementById('filterLoading');
            const downloadBtn = document.getElementById('downloadBtn');
            const imageCounter = document.getElementById('imageCounter');

            // 初始化加载图片
            loadWallpapers(wallpapers);

            // ========== 分类筛选功能 ==========
            filterBtns.forEach(btn => {
                btn.addEventListener('click', function () {
                    // 显示加载提示 + 禁用按钮
                    filterLoading.classList.remove('hidden');
                    filterBtns.forEach(b => b.disabled = true);

                    // 更新按钮激活状态
                    filterBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');

                    // 筛选逻辑
                    currentFilter = this.getAttribute('data-filter');

                    // 过滤图片
                    setTimeout(() => {
                        if (currentFilter === 'all') {
                            filteredWallpapers = wallpapers;
                        } else {
                            filteredWallpapers = wallpapers.filter(wp => wp.tags === currentFilter);
                        }

                        // 重新加载图片
                        loadWallpapers(filteredWallpapers);

                        // 隐藏加载提示 + 启用按钮
                        filterLoading.classList.add('hidden');
                        filterBtns.forEach(b => b.disabled = false);
                    }, 300);
                });
            });

            // ========== 图片加载函数 ==========
            function loadWallpapers(wallpaperList) {
                wallpaperGrid.innerHTML = '';

                wallpaperList.forEach((wallpaper, index) => {
                    const imgContainer = document.createElement('div');
                    imgContainer.className = 'relative overflow-hidden rounded-lg group';

                    const img = document.createElement('img');
                    img.src = wallpaper.src;
                    img.alt = wallpaper.alt;
                    img.className = 'wallpaper-img loading w-full h-48 rounded-lg';
                    img.loading = 'lazy';
                    img.dataset.index = index;
                    img.dataset.tags = wallpaper.tags;

                    // 标签指示器
                    const tagBadge = document.createElement('div');
                    tagBadge.className = 'absolute top-2 left-2 bg-black/70 text-white text-xs px-2 py-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-300';
                    tagBadge.textContent = wallpaper.tags;

                    imgContainer.appendChild(img);
                    imgContainer.appendChild(tagBadge);
                    wallpaperGrid.appendChild(imgContainer);

                    // 图片加载事件
                    img.addEventListener('load', () => {
                        img.classList.remove('loading');
                        img.classList.add('loaded');
                    });

                    img.addEventListener('error', () => {
                        img.classList.remove('loading');
                        img.alt = '图片加载失败';
                        img.src = 'https://via.placeholder.com/400x300/FF4D8D/ffffff?text=图片加载失败';
                    });

                    // 点击预览
                    img.addEventListener('click', function () {
                        currentPreviewIndex = parseInt(this.dataset.index);
                        openPreview(currentPreviewIndex, wallpaperList);
                    });
                });
            }

            // ========== 预览功能 ==========
            function openPreview(index, list) {
                currentPreviewIndex = index;
                const wallpaper = list[index];

                previewImg.src = wallpaper.src;
                previewImg.alt = wallpaper.alt;
                imageCounter.textContent = `${index + 1} / ${list.length}`;

                // 设置下载链接
                downloadBtn.onclick = () => {
                    const link = document.createElement('a');
                    link.href = wallpaper.src;
                    link.download = `wallpaper-${index + 1}.jpg`;
                    link.click();
                };

                // 显示预览
                previewModal.classList.add('active');
                previewModal.style.display = 'flex';
                document.body.style.overflow = 'hidden';

                // 图片加载错误处理
                previewImg.onerror = function () {
                    this.alt = '图片加载失败';
                    this.src = 'https://via.placeholder.com/800x600/FF4D8D/ffffff?text=图片加载失败';
                };
            }

            // 关闭预览
            function closePreview() {
                previewModal.classList.remove('active');
                setTimeout(() => {
                    previewModal.style.display = 'none';
                    document.body.style.overflow = '';
                }, 300);
            }

            // 导航到下一张/上一张图片
            function navigatePreview(direction) {
                if (currentFilter === 'all') {
                    filteredWallpapers = wallpapers;
                } else {
                    filteredWallpapers = wallpapers.filter(wp => wp.tags === currentFilter);
                }

                currentPreviewIndex += direction;

                // 循环导航
                if (currentPreviewIndex < 0) {
                    currentPreviewIndex = filteredWallpapers.length - 1;
                } else if (currentPreviewIndex >= filteredWallpapers.length) {
                    currentPreviewIndex = 0;
                }

                openPreview(currentPreviewIndex, filteredWallpapers);
            }

            // 关闭预览的多种方式
            closeBtn.addEventListener('click', closePreview);
            previewModal.addEventListener('click', (e) => e.target === previewModal && closePreview());
            document.addEventListener('keydown', (e) => {
                if (previewModal.style.display === 'flex') {
                    if (e.key === 'Escape') {
                        closePreview();
                    } else if (e.key === 'ArrowRight') {
                        navigatePreview(1);
                    } else if (e.key === 'ArrowLeft') {
                        navigatePreview(-1);
                    }
                }
            });

            // 触摸滑动切换
            let touchStartX = 0;
            previewModal.addEventListener('touchstart', (e) => {
                touchStartX = e.touches[0].clientX;
            });

            previewModal.addEventListener('touchend', (e) => {
                const touchEndX = e.changedTouches[0].clientX;
                const diff = touchEndX - touchStartX;

                if (Math.abs(diff) > 50) {
                    if (diff > 0) {
                        navigatePreview(-1); // 右滑 -> 上一张
                    } else {
                        navigatePreview(1); // 左滑 -> 下一张
                    }
                }
            });

            // 初始化筛选
            filteredWallpapers = wallpapers;
        });
    </script>
</body>
</html>
